<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>YRTN PODCASTS</title>
    
    <link rel="manifest" href="manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="YRTN">
    <link rel="apple-touch-icon" href="knockout.jpeg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.staticfile.org/remixicon/3.5.0/remixicon.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Microsoft YaHei"', 'sans-serif'],
                    },
                    colors: {
                        brand: { 50: '#f5f3ff', 500: '#8b5cf6', 600: '#7c3aed', 900: '#4c1d95' },
                        dark: { bg: '#0f172a', card: '#1e293b', border: '#334155' }
                    },
                    screens: { 'xs': '480px' }
                }
            }
        }
    </script>

    <style>
        * { -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        @media (max-width: 768px) { ::-webkit-scrollbar { display: none; } }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 12px; width: 12px; border-radius: 50%;
            background: #fff; cursor: pointer; margin-top: -4px; box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #4b5563; border-radius: 2px;
        }
        .playing-animation span {
            display: inline-block; width: 3px; height: 10px; background-color: #8b5cf6;
            animation: bounce 1s infinite ease-in-out; margin: 0 1px;
        }
        .playing-animation span:nth-child(2) { animation-delay: 0.1s; }
        .playing-animation span:nth-child(3) { animation-delay: 0.2s; }
        @keyframes bounce { 0%, 100% { height: 6px; } 50% { height: 16px; } }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-dark-bg text-slate-200 h-[100dvh] flex flex-col overflow-hidden font-sans text-base select-none">

    <nav class="h-16 border-b border-dark-border flex items-center justify-between px-4 md:px-6 bg-dark-bg/95 backdrop-blur z-20 shrink-0">
        <div class="flex items-center gap-2 md:gap-3">
            <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-brand-500/20">
                <i class="ri-netease-cloud-music-fill text-xl"></i>
            </div>
            <span class="text-lg md:text-xl font-bold tracking-tight text-white">YRTN</span>
        </div>

        <div class="flex bg-dark-card p-1 rounded-lg border border-dark-border">
            <button onclick="switchTab('music')" id="tab-music" class="px-3 md:px-4 py-1.5 rounded-md text-xs md:text-sm font-medium transition-all bg-brand-600 text-white shadow-sm">Music</button>
            <button onclick="switchTab('podcasts')" id="tab-podcasts" class="px-3 md:px-4 py-1.5 rounded-md text-xs md:text-sm font-medium text-slate-400 hover:text-white transition-all">Podcasts</button>
        </div>
        
        <button id="install-btn" class="hidden bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-full text-xs font-medium transition-all">
            Install App
        </button>
    </nav>

    <main class="flex-1 overflow-y-auto p-4 md:p-6 relative w-full" id="main-container">
        <div id="status-toast" class="hidden fixed top-20 left-1/2 -translate-x-1/2 bg-brand-600 text-white px-6 py-2 rounded-full shadow-xl z-50 text-xs md:text-sm font-medium animate-fade-in whitespace-nowrap border border-white/10">
            <span id="status-msg">Loading...</span>
        </div>

        <div id="view-music" class="max-w-7xl mx-auto space-y-6">
            <header class="mb-4">
                <h1 class="text-2xl md:text-3xl font-bold text-white mb-1">Featured Music</h1>
                <p class="text-slate-400 text-sm md:text-base">Fresh tracks curated for you.</p>
            </header>
            <div class="grid grid-cols-2 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-6" id="music-grid">
                </div>
        </div>

        <div id="view-podcasts" class="hidden max-w-5xl mx-auto space-y-6">
             <header class="mb-4">
                <h1 class="text-2xl md:text-3xl font-bold text-white mb-1">Latest Episodes</h1>
                <p class="text-slate-400 text-sm md:text-base">Deep dives and conversations.</p>
            </header>
            <div class="space-y-3 md:space-y-4" id="podcast-list"></div>
        </div>
        <div class="h-32"></div>
    </main>

    <footer class="h-20 md:h-24 bg-dark-card/95 backdrop-blur border-t border-dark-border fixed bottom-0 w-full px-3 md:px-6 flex items-center justify-between z-30 safe-bottom transition-all duration-300">
        <div class="flex items-center gap-3 w-full md:w-1/3 max-w-[60%] md:max-w-none">
            <img id="player-cover" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23334155' viewBox='0 0 100 100'%3E%3Crect width='100' height='100'/%3E%3C/svg%3E" class="w-10 h-10 md:w-14 md:h-14 rounded-md object-cover shadow-md bg-slate-800 shrink-0">
            <div class="overflow-hidden">
                <h4 id="player-title" class="text-white font-semibold text-sm truncate">Select a Track</h4>
                <p id="player-artist" class="text-slate-400 text-xs truncate">YRTN Podcasts</p>
            </div>
            <div class="hidden" id="visualizer">
                <div class="playing-animation flex items-end h-4 gap-[2px]"><span></span><span></span><span></span></div>
            </div>
        </div>

        <div class="flex flex-col items-end md:items-center w-auto md:w-1/3 md:max-w-md gap-1 md:gap-2 absolute right-3 md:static">
            <div class="flex items-center gap-4 md:gap-6">
                <button class="hidden md:block text-slate-400 hover:text-white transition-colors" onclick="skip(-1)"><i class="ri-skip-back-fill text-xl"></i></button>
                <button id="play-btn" class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white text-black flex items-center justify-center hover:scale-105 active:scale-95 transition-transform shadow-lg shadow-white/10" onclick="togglePlay()"><i class="ri-play-fill text-2xl md:text-3xl ml-0.5"></i></button>
                <button class="md:block text-slate-400 hover:text-white transition-colors" onclick="skip(1)"><i class="ri-skip-forward-fill text-2xl md:text-xl"></i></button>
            </div>
            <div class="hidden md:flex w-full items-center gap-3 text-xs text-slate-400">
                <span id="curr-time">0:00</span>
                <div class="relative w-full h-1 bg-slate-700 rounded-full group cursor-pointer" id="progress-container">
                    <div id="progress-bar" class="absolute top-0 left-0 h-full bg-brand-500 rounded-full w-0"></div>
                    <input type="range" id="seek-slider" min="0" max="100" value="0" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                </div>
                <span id="total-time">0:00</span>
            </div>
        </div>

        <div class="hidden md:flex items-center justify-end gap-3 w-1/3">
            <i class="ri-volume-up-line text-slate-400"></i>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8" class="w-24 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-brand-500">
        </div>
        
        <div class="md:hidden absolute top-0 left-0 w-full h-[3px] bg-slate-800">
             <div id="mobile-progress-bar" class="h-full bg-brand-500 w-0 transition-all duration-100"></div>
        </div>
        <audio id="audio-element" preload="none"></audio>
    </footer>

    <script>
        // --- PWA Registration ---
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed', err));
            });
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                installBtn.classList.add('hidden');
            }
            deferredPrompt = null;
        });

        // --- Core App Logic (Same as before) ---
        const audio = document.getElementById('audio-element');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const playerCover = document.getElementById('player-cover');
        const playBtn = document.getElementById('play-btn');
        const progressBar = document.getElementById('progress-bar');
        const mobileProgressBar = document.getElementById('mobile-progress-bar');
        const seekSlider = document.getElementById('seek-slider');
        const currTimeEl = document.getElementById('curr-time');
        const totalTimeEl = document.getElementById('total-time');
        const volumeSlider = document.getElementById('volume-slider');
        const visualizer = document.getElementById('visualizer');
        const statusMsg = document.getElementById('status-msg');

        let playlist = [];
        let currentTrackIndex = 0;
        let isPlaying = false;
        
        const sampleMusic = [
            { id: 1, title: "Neon Tokyo", artist: "Synthwave", cover: "https://images.unsplash.com/photo-1535478044878-3ed83d5456ef?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { id: 2, title: "Night Call", artist: "Future Bass", cover: "https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" }
        ];
        const samplePodcasts = [
            { id: 101, title: "Tech Trends CN", host: "Daily Tech", date: "Oct 20", cover: "https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" }
        ];

        async function init() {
            let musicData = sampleMusic;
            let podcastData = samplePodcasts;

            try {
                const res = await fetch('music.json');
                if (res.ok) musicData = await res.json();
            } catch (e) { console.log("Offline or no JSON, using samples"); }

            try {
                const res = await fetch('podcasts.json');
                if (res.ok) podcastData = await res.json();
            } catch (e) { }

            renderMusic(musicData);
            renderPodcasts(podcastData);
            playlist = musicData;
            setupAudioListeners();
        }

        function renderMusic(data) {
            document.getElementById('music-grid').innerHTML = data.map((track, i) => `
                <div class="group bg-dark-card p-3 md:p-4 rounded-xl cursor-pointer" onclick="playFromList('music', ${i})">
                    <div class="relative aspect-square rounded-lg overflow-hidden mb-2 bg-slate-800">
                        <img src="${track.cover}" class="w-full h-full object-cover group-hover:scale-105 transition-transform">
                    </div>
                    <h3 class="text-white font-semibold truncate text-sm md:text-base">${track.title}</h3>
                    <p class="text-slate-400 text-xs md:text-sm truncate">${track.artist}</p>
                </div>
            `).join('');
            window.musicData = data;
        }

        function renderPodcasts(data) {
            document.getElementById('podcast-list').innerHTML = data.map((pod, i) => `
                <div class="bg-dark-card p-3 md:p-4 rounded-xl flex gap-3 items-center cursor-pointer" onclick="playFromList('podcasts', ${i})">
                    <div class="w-16 h-16 rounded-lg overflow-hidden bg-slate-800 shrink-0"><img src="${pod.cover}" class="w-full h-full object-cover"></div>
                    <div class="min-w-0">
                        <div class="flex items-center gap-2 mb-0.5"><span class="text-[10px] font-bold text-brand-400 uppercase border border-brand-500/30 px-1 rounded">POD</span></div>
                        <h3 class="text-white font-bold text-sm md:text-lg truncate">${pod.title}</h3>
                    </div>
                </div>
            `).join('');
            window.podcastData = data;
        }

        function switchTab(tab) {
            const musicBtn = document.getElementById('tab-music');
            const podBtn = document.getElementById('tab-podcasts');
            if (tab === 'music') {
                document.getElementById('view-music').classList.remove('hidden');
                document.getElementById('view-podcasts').classList.add('hidden');
                musicBtn.classList.replace('text-slate-400', 'text-white'); musicBtn.classList.add('bg-brand-600');
                podBtn.classList.replace('text-white', 'text-slate-400'); podBtn.classList.remove('bg-brand-600');
            } else {
                document.getElementById('view-podcasts').classList.remove('hidden');
                document.getElementById('view-music').classList.add('hidden');
                podBtn.classList.replace('text-slate-400', 'text-white'); podBtn.classList.add('bg-brand-600');
                musicBtn.classList.replace('text-white', 'text-slate-400'); musicBtn.classList.remove('bg-brand-600');
            }
        }

        function playFromList(type, i) {
            playlist = type === 'music' ? window.musicData : window.podcastData;
            currentTrackIndex = i;
            loadTrack(playlist[i]);
            playAudio();
        }

        function loadTrack(track) {
            audio.src = track.url;
            playerTitle.innerText = track.title;
            playerArtist.innerText = track.artist || track.host;
            playerCover.src = track.cover;
            visualizer.classList.remove('hidden');
        }

        function togglePlay() {
            if (playlist.length === 0) return;
            if (!audio.src) loadTrack(playlist[0]);
            isPlaying ? audio.pause() : playAudio();
        }

        function playAudio() {
            audio.play().then(() => {
                isPlaying = true;
                playBtn.innerHTML = '<i class="ri-pause-fill text-2xl md:text-3xl"></i>';
                playerCover.classList.add('animate-pulse');
            }).catch(e => showToast('Tap play to start'));
        }

        function skip(dir) {
            if (!playlist.length) return;
            currentTrackIndex = (currentTrackIndex + dir + playlist.length) % playlist.length;
            loadTrack(playlist[currentTrackIndex]);
            playAudio();
        }

        audio.addEventListener('pause', () => {
            isPlaying = false;
            playBtn.innerHTML = '<i class="ri-play-fill text-2xl md:text-3xl ml-0.5"></i>';
            playerCover.classList.remove('animate-pulse');
        });

        function setupAudioListeners() {
            audio.addEventListener('timeupdate', (e) => {
                if (!audio.duration) return;
                const pct = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = pct + '%';
                mobileProgressBar.style.width = pct + '%';
                seekSlider.value = pct;
                const m = Math.floor(audio.currentTime / 60);
                const s = Math.floor(audio.currentTime % 60);
                currTimeEl.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
            });
            audio.addEventListener('loadedmetadata', () => {
                const m = Math.floor(audio.duration / 60);
                const s = Math.floor(audio.duration % 60);
                totalTimeEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
            });
            audio.addEventListener('ended', () => skip(1));
            seekSlider.addEventListener('input', () => audio.currentTime = (seekSlider.value / 100) * audio.duration);
            volumeSlider.addEventListener('input', (e) => audio.volume = e.target.value);
        }

        function showToast(msg) {
            const t = document.getElementById('status-toast');
            statusMsg.innerText = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
